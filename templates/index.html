<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Usate</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Intestazione -->
    <header>
        <h1>Ricerca Auto Usate</h1>
    </header>

    <!-- Sezione filtro -->
    <section id="filtro">
        <h2>Filtra le auto</h2>
        <form id="filtroForm">
            <label for="marca">Marca:</label>
            <input type="text" id="marca" name="marca">
            
            <label for="modello">Modello:</label>
            <input type="text" id="modello" name="modello">
            
            <label for="motore">Alimentazione:</label>
            <select id="motore" name="motore">
                <option value="">--</option>
                <option value="benzina">Benzina</option>
                <option value="diesel">Diesel</option>
            </select>
            
            <label for="colore">Colore:</label>
            <input type="text" id="colore" name="colore">
            
            <button type="submit">Cerca</button>
        </form>
    </section>

    <!-- Sezione risultati -->
    <section id="risultati">
        <h2>Risultati della ricerca</h2>
        <table>
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Modello</th>
                    <th>Motore</th>
                    <th>Colore</th>
                    <th>Immagine</th>
                </tr>
            </thead>
            <tbody id="risultatiTabella">
                <!-- I risultati verranno inseriti qui -->
            </tbody>
        </table>
    </section>

    <!-- Script per la gestione del form -->
    <script>
        document.getElementById('filtroForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Raccolta dati dal form
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            // Invio della richiesta al server
            const response = await fetch('/filtra_auto', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            // Conversione della risposta in JSON
            const auto = await response.json();

            // Aggiornamento della tabella dei risultati
            const risultatiTabella = document.getElementById('risultatiTabella');
            risultatiTabella.innerHTML = auto.map(a => `
                <tr>
                    <td>${a.marca}</td>
                    <td>${a.modello}</td>
                    <td>${a.motore}</td>
                    <td>${a.colore}</td>
                    <td><img src="${a.immagine}" width="100" alt="Immagine auto"></td>
                </tr>
            `).join('');
        });
    </script>
</body>
</html>
